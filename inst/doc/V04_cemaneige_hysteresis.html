<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Using satellite snow cover area data for calibrating and improving CemaNeige</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using satellite snow cover area data for calibrating and improving CemaNeige</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="scope" class="section level2">
<h2>Scope</h2>
<p>Rainfall-runoff models that include a snow accumulation and melt module are still often calibrated using only discharge observations. This can result in poor snow modeling as the swnow module parameters can distorted in order to allow skilful discharge simulation.</p>
<p>After the work of <span class="citation">Riboust et al. (2019)</span>, we propose now in <strong>airGR</strong> an improved version of the degree-day CemaNeige snow and accumulation module. This new version is based on a more accurate representation of the relationship that exists at the basin scale between the Snow Water Equivalent (SWE) and the Snow Cover Area (SCA). To do so, a linear SWE-SCA hysteresis, which represents the fact that snow accumulation is rather homogeneous on the basin and snow melt is more heterogeneous, was implemented.</p>
<p>This new CemaNeige version has two more parameters to calibrate. It also presents the advantage of allowing using satellite snow data to constrain the calibration in addition to discharge. <span class="citation">Riboust et al. (2019)</span> show that while the simulated discharge is not significantly improved, the snow simulation is much improved. In addition, they show that the model is more robust (i.e. transferable in time) in terms of discharge, which has many implications for climate change impact studies.</p>
<p>The configuration that was identified as optimal by <span class="citation">Riboust et al. (2019)</span> includes a CemaNeige module run on 5 elevation bands and an objective function determine by a composite function of KGE’ calculated on discharge (75 % weight) and KGE’ calculated on each elevation band (5 % for each).</p>
<p>In this page, we show how to use and calibrate this new CemaNeige version.</p>
</div>
<div id="data-preparation" class="section level2">
<h2>Data preparation</h2>
<p>We load an example data set from the package. Please note that this data set includes MODIS data that was pre-calculated for 5 elevation bands and for which days with few data (more than 40 % cloud coverage) were assigned as missing values.</p>
</div>
<div id="loading-catchment-data" class="section level2">
<h2>loading catchment data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">data</span>(X0310010)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">summary</span>(BasinObs)</a></code></pre></div>
</div>
<div id="object-model-preparation" class="section level2">
<h2>Object model preparation</h2>
<p>We assume that the R global environment contains data and functions from the <a href="V01_get_started.html">Get Started</a> vignette.</p>
<p>The calibration period has been defined from 2000-09-01 to 2005-08-31, and the validation period from 2005-09-01 to 2010-07-31. CemaNeige will be used in coupling with GR4J in this vignette.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">## preparation of the InputsModel object</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">InputsModel &lt;-<span class="st"> </span><span class="kw">CreateInputsModel</span>(<span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                                 <span class="dt">DatesR =</span> BasinObs<span class="op">$</span>DatesR, <span class="dt">Precip =</span> BasinObs<span class="op">$</span>P,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                                 <span class="dt">PotEvap =</span> BasinObs<span class="op">$</span>E, <span class="dt">TempMean =</span> BasinObs<span class="op">$</span>T,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">                                 <span class="dt">ZInputs =</span> <span class="kw">median</span>(BasinInfo<span class="op">$</span>HypsoData),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">                                 <span class="dt">HypsoData =</span> BasinInfo<span class="op">$</span>HypsoData, <span class="dt">NLayers =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">## ---- calibration step</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">## calibration period selection</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">Ind_Cal &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">which</span>(<span class="kw">format</span>(BasinObs<span class="op">$</span>DatesR, <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="op">==</span><span class="st"> &quot;2000-09-01&quot;</span>), </a>
<a class="sourceLine" id="cb2-12" data-line-number="12">               <span class="kw">which</span>(<span class="kw">format</span>(BasinObs<span class="op">$</span>DatesR, <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="op">==</span><span class="st"> &quot;2005-08-31&quot;</span>))</a>
<a class="sourceLine" id="cb2-13" data-line-number="13"></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">## ---- validation step</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">## validation period selection</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">Ind_Val &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">which</span>(<span class="kw">format</span>(BasinObs<span class="op">$</span>DatesR, <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="op">==</span><span class="st"> &quot;2005-09-01&quot;</span>), </a>
<a class="sourceLine" id="cb2-19" data-line-number="19">               <span class="kw">which</span>(<span class="kw">format</span>(BasinObs<span class="op">$</span>DatesR, <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="op">==</span><span class="st"> &quot;2010-07-31&quot;</span>))</a></code></pre></div>
</div>
</div>
<div id="calibration-and-evaluation-of-the-new-cemaneige-module" class="section level1">
<h1>Calibration and evaluation of the new CemaNeige module</h1>
<p>In order to use the Linear Hysteresis, a new argument (<code>IsHyst</code>) is added in the <code>CreateRunOptions()</code> and <code>CreateCalibOptions()</code> functions and has to be set to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">## preparation of the RunOptions object for the calibration period</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">RunOptions_Cal &lt;-<span class="st"> </span><span class="kw">CreateRunOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                                   <span class="dt">InputsModel =</span> InputsModel, <span class="dt">IndPeriod_Run =</span> Ind_Cal,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                                   <span class="dt">IsHyst =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">## preparation of the RunOptions object for the validation period</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">RunOptions_Val &lt;-<span class="st"> </span><span class="kw">CreateRunOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">                                   <span class="dt">InputsModel =</span> InputsModel, <span class="dt">IndPeriod_Run =</span> Ind_Val,</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">                                   <span class="dt">IsHyst =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">## preparation of the CalibOptions object</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">CalibOptions &lt;-<span class="st"> </span><span class="kw">CreateCalibOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">                                   <span class="dt">FUN_CALIB =</span> Calibration_Michel,</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">                                   <span class="dt">IsHyst =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>In order to calibrate and assess the model performance, we will follow the recommendations of <span class="citation">Riboust et al. (2019)</span>. This is now possible in <strong>airGR</strong> with the added functionality that permits calculating composite criteria by combining different metrics.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">## efficiency criterion: 75 % KGE'(Q) + 5 % KGE'(SCA) on each of the 5 layers</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">InputsCrit_Cal  &lt;-<span class="st"> </span><span class="kw">CreateInputsCrit</span>(<span class="dt">FUN_CRIT =</span> <span class="kw">rep</span>(<span class="st">&quot;ErrorCrit_KGE2&quot;</span>, <span class="dv">6</span>),</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                                    <span class="dt">InputsModel =</span> InputsModel, <span class="dt">RunOptions =</span> RunOptions_Cal,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                                    <span class="dt">Obs =</span> <span class="kw">list</span>(BasinObs<span class="op">$</span>Qmm[Ind_Cal],</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                                               BasinObs<span class="op">$</span>SCA1[Ind_Cal],</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                                               BasinObs<span class="op">$</span>SCA2[Ind_Cal],</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                                               BasinObs<span class="op">$</span>SCA3[Ind_Cal],</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">                                               BasinObs<span class="op">$</span>SCA4[Ind_Cal],</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">                                               BasinObs<span class="op">$</span>SCA5[Ind_Cal]),</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">                                    <span class="dt">VarObs =</span> <span class="kw">list</span>(<span class="st">&quot;Q&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>),</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">                                    <span class="dt">Weights =</span> <span class="kw">list</span>(<span class="fl">0.75</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">InputsCrit_Val  &lt;-<span class="st"> </span><span class="kw">CreateInputsCrit</span>(<span class="dt">FUN_CRIT =</span> <span class="kw">rep</span>(<span class="st">&quot;ErrorCrit_KGE2&quot;</span>, <span class="dv">6</span>),</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">                                    <span class="dt">InputsModel =</span> InputsModel, <span class="dt">RunOptions =</span> RunOptions_Val,</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">                                    <span class="dt">Obs =</span> <span class="kw">list</span>(BasinObs<span class="op">$</span>Qmm[Ind_Val],</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">                                               BasinObs<span class="op">$</span>SCA1[Ind_Val],</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">                                               BasinObs<span class="op">$</span>SCA2[Ind_Val],</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">                                               BasinObs<span class="op">$</span>SCA3[Ind_Val],</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">                                               BasinObs<span class="op">$</span>SCA4[Ind_Val],</a>
<a class="sourceLine" id="cb4-20" data-line-number="20">                                               BasinObs<span class="op">$</span>SCA5[Ind_Val]),</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">                                    <span class="dt">VarObs =</span> <span class="kw">list</span>(<span class="st">&quot;Q&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>, <span class="st">&quot;SCA&quot;</span>),</a>
<a class="sourceLine" id="cb4-22" data-line-number="22">                                    <span class="dt">Weights =</span> <span class="kw">list</span>(<span class="fl">0.75</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))</a></code></pre></div>
<p>We can now calibrate the model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">## calibration</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">OutputsCalib &lt;-<span class="st"> </span><span class="kw">Calibration</span>(<span class="dt">InputsModel =</span> InputsModel, <span class="dt">RunOptions =</span> RunOptions_Cal,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                            <span class="dt">InputsCrit =</span> InputsCrit_Cal, <span class="dt">CalibOptions =</span> CalibOptions,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                            <span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                            <span class="dt">FUN_CALIB =</span> Calibration_Michel)</a></code></pre></div>
<p>Now we can run it on the calibration period and assess it.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">## run on the calibration period</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">OutputsModel_Cal &lt;-<span class="st"> </span><span class="kw">RunModel_CemaNeigeGR4J</span>(<span class="dt">InputsModel =</span> InputsModel,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                                           <span class="dt">RunOptions =</span> RunOptions_Cal, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                                           <span class="dt">Param =</span> OutputsCalib<span class="op">$</span>ParamFinalR)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">## evaluation </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">OutputsCrit_Cal &lt;-<span class="st"> </span><span class="kw">ErrorCrit</span>(<span class="dt">InputsCrit =</span> InputsCrit_Cal, <span class="dt">OutputsModel =</span> OutputsModel_Cal)</a></code></pre></div>
<p>Find below the performance of the model over the calibration period.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">str</span>(OutputsCrit_Cal, <span class="dt">max.level =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.899
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.919 0.705 0.847 0.88 0.874 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
<p>Now we can run the model on the validation period and assess it.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">## run on the validation period</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">OutputsModel_Val &lt;-<span class="st"> </span><span class="kw">RunModel_CemaNeigeGR4J</span>(<span class="dt">InputsModel =</span> InputsModel,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                                           <span class="dt">RunOptions =</span> RunOptions_Val, </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                                           <span class="dt">Param =</span> OutputsCalib<span class="op">$</span>ParamFinalR)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">## evaluation </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">OutputsCrit_Val &lt;-<span class="st"> </span><span class="kw">ErrorCrit</span>(<span class="dt">InputsCrit =</span> InputsCrit_Val, <span class="dt">OutputsModel =</span> OutputsModel_Val)</a></code></pre></div>
<p>Find below the performance of the model over the validation period.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">str</span>(OutputsCrit_Val, <span class="dt">max.level =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.903
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.916 0.63 0.876 0.945 0.962 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
</div>
<div id="comparison-with-the-performance-of-the-initial-cemaneige-version" class="section level1">
<h1>Comparison with the performance of the initial CemaNeige version</h1>
<p>Here we use the same InputsModel object and calibration and validation periods. However, we have to redefine the way we run the model (<code>RunOptions</code> argument), calibrate and assess it (<code>InputsCrit</code> argument). The objective function is only based on KGE’(Q). Note how we set the <code>IsHyst</code> argument to <code>FALSE</code> in the <code>CreateRunOptions()</code> and the <code>CreateCalibOptions()</code> functions.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">## preparation of RunOptions object</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">RunOptions_Cal_NoHyst &lt;-<span class="st"> </span><span class="kw">CreateRunOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">                                          <span class="dt">InputsModel =</span> InputsModel,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">                                          <span class="dt">IndPeriod_Run =</span> Ind_Cal,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">                                          <span class="dt">IsHyst =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">RunOptions_Val_NoHyst &lt;-<span class="st"> </span><span class="kw">CreateRunOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">                                          <span class="dt">InputsModel =</span> InputsModel, </a>
<a class="sourceLine" id="cb12-9" data-line-number="9">                                          <span class="dt">IndPeriod_Run =</span> Ind_Val,</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">                                          <span class="dt">IsHyst =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"></a>
<a class="sourceLine" id="cb12-12" data-line-number="12">InputsCrit_Cal_NoHyst &lt;-<span class="st"> </span><span class="kw">CreateInputsCrit</span>(<span class="dt">FUN_CRIT =</span> ErrorCrit_KGE2,</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">                                          <span class="dt">InputsModel =</span> InputsModel,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">                                          <span class="dt">RunOptions =</span> RunOptions_Cal_NoHyst,</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">                                          <span class="dt">Obs =</span> BasinObs<span class="op">$</span>Qmm[Ind_Cal], <span class="dt">VarObs =</span> <span class="st">&quot;Q&quot;</span>)</a>
<a class="sourceLine" id="cb12-16" data-line-number="16"></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">## preparation of CalibOptions object</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18">CalibOptions_NoHyst &lt;-<span class="st"> </span><span class="kw">CreateCalibOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb12-19" data-line-number="19">                                          <span class="dt">FUN_CALIB =</span> Calibration_Michel,</a>
<a class="sourceLine" id="cb12-20" data-line-number="20">                                          <span class="dt">IsHyst =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>We can now calibrate the model.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">## calibration</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">OutputsCalib_NoHyst &lt;-<span class="st"> </span><span class="kw">Calibration</span>(<span class="dt">InputsModel =</span> InputsModel,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                                   <span class="dt">InputsCrit =</span> InputsCrit_Cal_NoHyst,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">                                   <span class="dt">RunOptions =</span> RunOptions_Cal_NoHyst,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">                                   <span class="dt">CalibOptions =</span> CalibOptions_NoHyst,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">                                   <span class="dt">FUN_MOD =</span> RunModel_CemaNeigeGR4J,</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">                                   <span class="dt">FUN_CALIB =</span> Calibration_Michel)</a></code></pre></div>
<p>And run it over the calibration and validation periods.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">OutputsModel_Cal_NoHyst &lt;-<span class="st"> </span><span class="kw">RunModel_CemaNeigeGR4J</span>(<span class="dt">InputsModel =</span> InputsModel,</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">                                                  <span class="dt">RunOptions =</span> RunOptions_Cal_NoHyst,  </a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                                                  <span class="dt">Param =</span> OutputsCalib_NoHyst<span class="op">$</span>ParamFinalR)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">OutputsModel_Val_NoHyst &lt;-<span class="st"> </span><span class="kw">RunModel_CemaNeigeGR4J</span>(<span class="dt">InputsModel =</span> InputsModel,</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">                                                  <span class="dt">RunOptions =</span> RunOptions_Val_NoHyst, </a>
<a class="sourceLine" id="cb14-7" data-line-number="7">                                                  <span class="dt">Param =</span> OutputsCalib_NoHyst<span class="op">$</span>ParamFinalR)</a></code></pre></div>
<p>In order to assess the model performance over the two periods, we will use the InputsCrit objects prepared before, which allow assessing also the performance in terms of snow simulation.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">OutputsCrit_Cal_NoHyst &lt;-<span class="st"> </span><span class="kw">ErrorCrit</span>(<span class="dt">InputsCrit =</span> InputsCrit_Cal,</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">                                    <span class="dt">OutputsModel =</span> OutputsModel_Cal_NoHyst)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">OutputsCrit_Val_NoHyst &lt;-<span class="st"> </span><span class="kw">ErrorCrit</span>(<span class="dt">InputsCrit =</span> InputsCrit_Val,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">                                    <span class="dt">OutputsModel =</span> OutputsModel_Val_NoHyst)</a></code></pre></div>
<p>We can check the performance over the calibration and the validation period.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">str</span>(OutputsCrit_Cal_NoHyst, <span class="dt">max.level =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.836
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.937 0.147 0.48 0.65 0.707 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">str</span>(OutputsCrit_Val_NoHyst, <span class="dt">max.level =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## List of 7
##  $ CritValue      : num 0.773
##  $ CritName       : chr &quot;Composite&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: NULL
##  $ CritCompo      :List of 3
##   ..$ MultiCritValues : Named num [1:6] 0.878 0.159 0.363 0.495 0.593 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritNames  : Named chr [1:6] &quot;KGE2[Q]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; &quot;KGE2[SCA]&quot; ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##   ..$ MultiCritWeights: Named num [1:6] 0.75 0.05 0.05 0.05 0.05 0.05
##   .. ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;IC1&quot; &quot;IC2&quot; &quot;IC3&quot; &quot;IC4&quot; ...
##  $ MultiCrit      :List of 6
##   ..$ IC1:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC2:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC3:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC4:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC5:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##   ..$ IC6:List of 7
##   .. ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;KGE2&quot; &quot;ErrorCrit&quot;
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;Compo&quot; &quot;ErrorCrit&quot;</code></pre>
<p>We can see above that the performance of the initial model is slightly better than the new one over the calibration period in terms of discharge, but also that the new version calibrated using SCA provides better performance in terms of snow. However, over the validation period, we see that the discharge simulated by the new version brings better performance (in addition to improved SCA also). This shows the interests of the combined use of a linear hysteresis and of SCA data for calibration in CemaNeige.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-riboust_revisiting_2019">
<p>Riboust, Philippe, Guillaume Thirel, Nicolas Le Moine, and Pierre Ribstein. 2019. “Revisiting a Simple Degree-Day Model for Integrating Satellite Data: Implementation of Swe-Sca Hystereses.” <em>Journal of Hydrology and Hydromechanics</em> 67 (1): 70–81. <a href="https://doi.org/10.2478/johh-2018-0004">https://doi.org/10.2478/johh-2018-0004</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
